<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Suivi de Sympt√¥mes ‚Äî Cabinet M√©dical</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--muted:#6b7280;--accent:#0ea5a4;--danger:#ef4444}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#f8fafc,#eef2f7);color:#0f172a}
    .container{max-width:1100px;margin:24px auto;padding:20px}
    .main-nav{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:12px}
    .nav-link{padding:8px 12px;border-radius:8px;text-decoration:none;background:transparent;color:var(--muted);border:1px solid transparent}
    .nav-link.active{background:var(--card);color:#0f172a;border-color:#e6eef3;box-shadow:0 1px 2px rgba(15,23,42,.04)}
    .page-title{margin:0;font-size:1.5rem}
    .page-subtitle{margin:.25rem 0 .75rem;color:var(--muted)}
    .header{background:transparent;padding:12px 0}
    .stats{display:flex;gap:12px;margin-top:8px}
    .stat-item{background:var(--card);padding:10px 14px;border-radius:10px;min-width:120px;box-shadow:0 1px 3px rgba(15,23,42,.04)}
    .stat-number{font-weight:700;font-size:1.25rem}
    .stat-label{color:var(--muted);font-size:.85rem}
    .main-content{display:flex;gap:20px;flex-wrap:wrap;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.04);}
    .form-section{flex:1 1 420px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type=text], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef3;background:#fff}
    .symptom-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:8px}
    .symptom-item{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;border:1px solid #eef5f7}
    .submit-btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:#fff;border:none;font-weight:600;cursor:pointer}
    .display-section{flex:1 1 420px;min-width:320px}
    .mood-list{max-height:420px;overflow:auto;padding:8px;border-radius:8px;border:1px dashed #e6eef3}
    .report{padding:10px;border-radius:8px;border-bottom:1px solid #f1f5f9}
    .meta{font-size:.85rem;color:var(--muted);margin-top:6px}
    .bar{height:10px;border-radius:999px;background:#e6f6f6;margin-top:6px;overflow:hidden}
    .bar > span{display:block;height:100%;background:var(--accent);width:0}
    footer{margin-top:18px;color:var(--muted);font-size:.85rem;text-align:center}
    .small{font-size:.85rem;color:var(--muted)}
    .privacy{margin-top:8px;font-size:.82rem;color:#374151}
    .doctor-toggle{background:#fff;border:1px solid #e6eef3;padding:8px;border-radius:8px;cursor:pointer}
    @media(max-width:860px){.main-content{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <nav class="main-nav">
      <a class="nav-link active">üè• Suivi Sympt√¥mes</a>
      <a class="nav-link">üìä Tableau de bord</a>
      <a class="nav-link">üë©‚Äç‚öïÔ∏è Espace M√©decin</a>
      <a class="nav-link">‚öôÔ∏è Param√®tres</a>
    </nav>

    <header class="header">
      <h1 class="page-title">ü©∫ Suivi de sympt√¥mes ‚Äî Cabinet</h1>
      <p class="page-subtitle">D√©clarez rapidement vos sympt√¥mes. Donn√©es stock√©es localement (prototype). Pour production : authentification & h√©bergement s√©curis√© (RGPD).</p>

      <div class="stats">
        <div class="stat-item"><div class="stat-number" id="totalReports">0</div><div class="stat-label">D√©clarations</div></div>
        <div class="stat-item"><div class="stat-number" id="uniquePatients">0</div><div class="stat-label">Patients uniques</div></div>
        <div class="stat-item"><div class="stat-number" id="symptomVariety">0</div><div class="stat-label">Sympt√¥mes diff√©rents</div></div>
      </div>
    </header>

    <div class="main-content">
      <section class="form-section card">
        <h2 style="margin-top:0">üìù D√©clarer un sympt√¥me</h2>
        <form id="reportForm">
          <div style="margin-bottom:10px">
            <label for="patientId">Nom / Identifiant patient</label>
            <input id="patientId" type="text" placeholder="Ex : Dupont / ID:12345" maxlength="60" required>
          </div>

          <div style="margin-bottom:10px">
            <label>Sympt√¥mes (cochez tout ce qui s'applique)</label>
            <div class="symptom-grid" id="symptomGrid">
              <label class="symptom-item"><input type="checkbox" value="Douleur"> Douleur</label>
              <label class="symptom-item"><input type="checkbox" value="Fi√®vre"> Fi√®vre</label>
              <label class="symptom-item"><input type="checkbox" value="Toux"> Toux</label>
              <label class="symptom-item"><input type="checkbox" value="Fatigue"> Fatigue</label>
              <label class="symptom-item"><input type="checkbox" value="Naus√©e"> Naus√©e</label>
              <label class="symptom-item"><input type="checkbox" value="Essoufflement"> Essoufflement</label>
              <label class="symptom-item"><input type="checkbox" value="Maux de t√™te"> Maux de t√™te</label>
              <label class="symptom-item"><input type="checkbox" value="Diarrh√©e"> Diarrh√©e</label>
              <label class="symptom-item"><input type="checkbox" value="Vertiges"> Vertiges</label>
              <label class="symptom-item"><input type="checkbox" value="Perte go√ªt/odorat"> Perte go√ªt/odorat</label>
              <label class="symptom-item"><input type="checkbox" value="√âruption cutan√©e"> √âruption cutan√©e</label>
              <label class="symptom-item"><input type="checkbox" value="Autre"> Autre</label>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center">
            <div style="flex:1">
              <label for="location">Localisation</label>
              <select id="location" required>
                <option value="">Choisir...</option>
                <option value="T√™te">T√™te</option>
                <option value="Thorax">Thorax</option>
                <option value="Abdomen">Abdomen</option>
                <option value="Membres sup√©rieurs">Membres sup√©rieurs</option>
                <option value="Membres inf√©rieurs">Membres inf√©rieurs</option>
                <option value="G√©n√©ralis√©">G√©n√©ralis√©</option>
              </select>
            </div>
            <div style="width:160px">
              <label for="intensity">Intensit√© (0-10)</label>
              <input id="intensity" type="range" min="0" max="10" value="3">
              <div class="small">Valeur : <span id="intensityValue">3</span></div>
            </div>
          </div>

          <div style="margin-bottom:10px">
            <label for="comment">Commentaire (optionnel)</label>
            <textarea id="comment" rows="3" placeholder="Ex : apparu apr√®s effort, am√©lioration apr√®s m√©dication..."></textarea>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <button class="submit-btn" type="submit">Envoyer ma d√©claration</button>
            <button type="button" id="clearBtn" class="doctor-toggle">Effacer les donn√©es locales</button>
          </div>

          <p class="privacy">Prototype ‚Äî donn√©es stock√©es localement dans le navigateur. Pour une version production : mettre en place authentification, stockage chiffr√© et conformit√© RGPD.</p>
        </form>
      </section>

      <aside class="display-section">
        <h2 style="margin-top:0">üìã Flux des d√©clarations</h2>
        <div class="mood-list" id="reportList">
          <div class="loading">Aucune d√©claration pour le moment ‚Äî soyez le premier¬∑√®re.</div>
        </div>

        <h3 style="margin-top:12px">üîé R√©sum√©</h3>
        <div class="card" id="summaryCard">
          <div class="small">Top sympt√¥mes (par fr√©quence)</div>
          <div id="symptomBars" style="margin-top:8px"></div>
        </div>
      </aside>
    </div>

    <footer>¬© <span id="year"></span> Cabinet ‚Äî Prototype de suivi ‚Ä¢ Ne remplace pas un avis m√©dical.</footer>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('reportForm');
    const reportList = document.getElementById('reportList');
    const totalReportsEl = document.getElementById('totalReports');
    const uniquePatientsEl = document.getElementById('uniquePatients');
    const symptomVarietyEl = document.getElementById('symptomVariety');
    const intensity = document.getElementById('intensity');
    const intensityValue = document.getElementById('intensityValue');
    const clearBtn = document.getElementById('clearBtn');

    intensity.addEventListener('input', () => intensityValue.textContent = intensity.value);

    // r√©cup√©rer les rapports depuis localStorage
    function loadReports(){
      try{
        const raw = localStorage.getItem('symptomReports');
        return raw ? JSON.parse(raw) : [];
      }catch(e){console.error('Erreur lecture storage',e); return []}
    }

    function saveReports(list){
      localStorage.setItem('symptomReports', JSON.stringify(list));
    }

    function renderReports(){
      const reports = loadReports();
      reportList.innerHTML = '';
      if(reports.length===0){ reportList.innerHTML = '<div class="loading">Aucune d√©claration pour le moment ‚Äî soyez le premier¬∑√®re.</div>'; }
      reports.slice().reverse().forEach(r => {
        const el = document.createElement('div'); el.className='report';
        el.innerHTML = `<strong>${escapeHtml(r.patient)}</strong> ‚Äî <span class="small">${new Date(r.time).toLocaleString()}</span>
          <div class="meta">Sympt√¥mes: ${escapeHtml(r.symptoms.join(', ') || '‚Äî')} ‚Ä¢ Localisation: ${escapeHtml(r.location)} ‚Ä¢ Intensit√©: ${r.intensity}</div>
          ${r.comment ? `<div class="small" style="margin-top:6px">Note : ${escapeHtml(r.comment)}</div>` : ''}`;
        reportList.appendChild(el);
      });
      renderSummary();
    }

    function renderSummary(){
      const reports = loadReports();
      // stats
      totalReportsEl.textContent = reports.length;
      const patients = new Set(reports.map(r=>r.patient));
      uniquePatientsEl.textContent = patients.size;
      // symptom variety
      const allSymptoms = reports.flatMap(r=>r.symptoms);
      const uniqueSymptoms = new Set(allSymptoms.filter(Boolean));
      symptomVarietyEl.textContent = uniqueSymptoms.size;

      // frequency
      const freq = {};
      for(const s of allSymptoms){ if(!s) continue; freq[s] = (freq[s]||0)+1 }
      const entries = Object.entries(freq).sort((a,b)=>b[1]-a[1]);

      const container = document.getElementById('symptomBars'); container.innerHTML='';
      if(entries.length===0){ container.innerHTML = '<div class="small">Aucune donn√©e.</div>'; return }

      const max = entries[0][1];
      for(const [sym,count] of entries.slice(0,8)){
        const wrapper = document.createElement('div'); wrapper.style.marginBottom='8px';
        const title = document.createElement('div'); title.textContent = `${sym} ‚Äî ${count}`; title.className='small';
        const bar = document.createElement('div'); bar.className='bar';
        const inner = document.createElement('span'); inner.style.width = Math.round((count/max)*100)+'%';
        bar.appendChild(inner);
        wrapper.appendChild(title); wrapper.appendChild(bar);
        container.appendChild(wrapper);
      }
    }

    function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m] }); }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const patient = document.getElementById('patientId').value.trim();
      if(!patient) return alert('Veuillez renseigner l\'identifiant patient.');
      const checkboxes = Array.from(document.querySelectorAll('#symptomGrid input[type=checkbox]'));
      const symptoms = checkboxes.filter(c=>c.checked).map(c=>c.value);
      if(symptoms.length===0) return alert('S√©lectionnez au moins un sympt√¥me.');
      const location = document.getElementById('location').value;
      if(!location) return alert('Choisissez une localisation.');
      const comment = document.getElementById('comment').value.trim();
      const intensityVal = parseInt(document.getElementById('intensity').value,10);

      const reports = loadReports();
      reports.push({patient, symptoms, location, comment, intensity: intensityVal, time: new Date().toISOString()});
      saveReports(reports);
      renderReports();

      // feedback rapide
      form.reset(); intensity.value=3; intensityValue.textContent='3';
      // keep first checkbox state cleared
      alert('D√©claration enregistr√©e (prototype local).');
    });

    clearBtn.addEventListener('click', ()=>{
      if(!confirm('Effacer toutes les donn√©es locales de test ?')) return;
      localStorage.removeItem('symptomReports');
      renderReports();
    });

    // initial render
    renderReports();
  </script>
</body>
</html>
